{"data":{"markdownRemark":{"html":"<h2 id=\"title-多任务切图部署建议\"><a href=\"#title-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E5%9B%BE%E9%83%A8%E7%BD%B2%E5%BB%BA%E8%AE%AE\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>title: 多任务切图部署建议</h2>\n<p>由于多任务切图过程中针对不同的瓦片类型（原始、紧凑或 MongoDB）、切图数据和瓦片的存储位置（本地或共享）、切图方式（单机多任务或多机多任务）等多种因素均会对切图效率产生一定影响，为使用户配置出适合自己当前环境的最优切图方案，通过反复多次的测试验证，整理出来四类测试场景，通过以下场景切图效率对比，分析总结得出合理的结论，为用户部署多任务切图提供参考和建议。</p>\n<ol>\n<li><strong>单机多任务切图</strong>：比对单机多任务切原始、紧凑或 MongoDB 型瓦片的切图效率。  </li>\n<li><strong>多机多任务切图</strong>：比对用多机多任务切原始、紧凑或 MongoDB 型瓦片的效率切图效率。  </li>\n<li><strong>本地和远程路径切图</strong>：比对切图数据和瓦片存储在本地和远程对切图速率的影响。   </li>\n<li><strong>矢量/栅格地图切图</strong>：比对多任务切矢量地图和栅格地图的切图效率。 </li>\n</ol>\n<h3 id=\"测试数据与环境\"><a href=\"#%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E4%B8%8E%E7%8E%AF%E5%A2%83\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>测试数据与环境</h3>\n<p>以上四类场景分别使用了相同矢量地图数据、切图范围、切图比例尺以及瓦片参数均相同，具体信息如下：</p>\n<ul>\n<li>测试数据：选取矢量地图，矢量数据集最大对象个数为8324287，文件大小为12.4G，图层数：326个。  </li>\n<li>切图范围：[左:11427641.47674698,下:2817774.6107045934,右:12993071.816027392,上:4383204.9499850012]，拆封为100个子任务数，总计产生1638400张瓦片。   </li>\n<li>切图比例尺：1:18,055.9909335062(仅1个比例尺)；   </li>\n<li>设置瓦片参数：所有测试场景设置的地图瓦片关键参数，均为：版本号是5.0；图片类型是JPG；块大小(像素)是256*256；图片压缩率是75。</li>\n</ul>\n<h3 id=\"单机多任务切图效率\"><a href=\"#%E5%8D%95%E6%9C%BA%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E5%9B%BE%E6%95%88%E7%8E%87\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>单机多任务切图效率</h3>\n<ul>\n<li>MongoDB 型瓦片: 瓦片存储为本地存储；地图本地地图；测试机器：64位，4核CPU。增加进程数得到如下效率对比图：<br>\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ProcessDiagram1-d8b925f3b7abaaa7121620b52d878436-c55d3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 637px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 48.665620094191524%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAByklEQVQoz6VS226cMBDl/7+hD61U9fKQKK0SNa3SNhsSVYrUZlMpTboKIVyWBQPGBgwst1Pbu2wvrx3p4JkxPnPGHmMYBvyLcRxRFAUYY+CcI8sy5HmOuq41hBBommbzv/x3GEZ9RsWG+kzW973eUFAkhBAkSaJXSjNUVSXzFDlnEGWBcWglOmDsdQF1zpgUKeu6TpP2/e8ik62bClQWiVMGJ0jwwwpwce1gfudriLLU6ncKFZFuYyt9HGRcC/Ccw1vFMK99vL/08PLkAftnLt6cL7E38/H5KsKzYxdNlesudoTqrgiJFbWsVMEPCS5vfJx+8/D6o4XDCw9vTRcHMwfvvng4OndkzoE5D/D8+B5dWyOSV7MjVO0OfStbCWFe2Xh6dCsPuHjxwcKrExsHZx72Z0qhJDV97e+d+vj0NcKTQxttU8rHqmCo+ypEB3+50i9pBzkWbgbL57CXHPcew08nw8PWXzhqj2nfkngMOG5tKgX1Wpgh6hbzRYjvN3ewHn2QmIIkGZKUYhWlCEmCMJIgqYw3q/bDBHFCN7koRrPeEq7bHnkpZP8xGJezlwukWYFM+lSvJSgrdlDxlGN/7E2T8dcc/o9N8/sLiRPyWFFOUskAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"ProcessDiagram1\"\n        title=\"\"\n        src=\"/static/ProcessDiagram1-d8b925f3b7abaaa7121620b52d878436-c55d3.png\"\n        srcset=\"/static/ProcessDiagram1-d8b925f3b7abaaa7121620b52d878436-1aa85.png 210w,\n/static/ProcessDiagram1-d8b925f3b7abaaa7121620b52d878436-b1233.png 420w,\n/static/ProcessDiagram1-d8b925f3b7abaaa7121620b52d878436-c55d3.png 637w\"\n        sizes=\"(max-width: 637px) 100vw, 637px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n        </li>\n<li>原始型瓦片: 瓦片存储为本地存储；地图本地地图；测试机器：32位，2核CPU。增加进程数得到如下效率对比图：<br>\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ProcessDiagram2-cedcd8114cbb0cedb0a8c381d9ec53b0-0678c.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 643px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 46.3452566096423%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABxklEQVQoz12Su28UMRDG909NQ5WKigJoiZRIQIFQECAKEBEVuiBRpONVEF4BdAlJ7k536O6UfXtt73q93r2P8WwuBZZW89vxzOeZsYOu6/D/t1qtUNc1pJTQWrNVSsEYA0nWOccx69g1t22LwMN6rTf9KssKYRQhjhMkcYQwDJFmObI0YWFHyX61lO/aXsNrXQn6IGvtlXAPHWxdwVBuSfuVLqAacJWyyCBMB11qtLZCd1ll4JN9qUIIbsU7vbBpWowWBb4ML0CN4fAkxeDDgs95/zPBweEF8/fTBGczQWc7Hg0LeiHfkreWZjebexFg/9MS13Z+cOLuYIKNrW/Md57/wfUHv5hvPRlie++cyGG+WPYt+3KNqdn5+TjD5r1e5A0Jbmx9ZX72dorN+0fMd1+d4+bjIfPtp0Ps7J0x26ZBQIPyw+LbpLFyazd2f7Pv3VFE1Zxw8P7HBbZfnjK/OJjh4esR86PBmP99fNM4BLmyOB5HGI0nCGMBqQ2ELFFoS7ZCkknyWeRFiUzQZZQ954VmToUmv0Zlmv7ZCGUwmS4x/TtH7JNVhTjJOLhQJT8VRezF0kxAVw2SVFyyI1sgFxLGtiTY4R8zzKM+yhHm7wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"ProcessDiagram2\"\n        title=\"\"\n        src=\"/static/ProcessDiagram2-cedcd8114cbb0cedb0a8c381d9ec53b0-0678c.png\"\n        srcset=\"/static/ProcessDiagram2-cedcd8114cbb0cedb0a8c381d9ec53b0-47672.png 210w,\n/static/ProcessDiagram2-cedcd8114cbb0cedb0a8c381d9ec53b0-a12c5.png 420w,\n/static/ProcessDiagram2-cedcd8114cbb0cedb0a8c381d9ec53b0-0678c.png 643w\"\n        sizes=\"(max-width: 643px) 100vw, 643px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n        </li>\n<li>紧凑型瓦片: 瓦片存储为本地存储；地图本地地图；测试机器：64位，4核CPU。增加进程数得到如下效率对比图：<br>\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ProcessDiagram3-7471e1e730018c3a11bdaa2a828668eb-103bb.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 649px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 46.379044684129425%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABrUlEQVQoz3VS207bQBD1P1aI/khfgb70BwDxWKkgIZUWqbxU4oEnJAhCCBTKNQ2huRg7cbwX2+v1ZU9nNzEgJEY6ntHOztkzM/bqukYDY8yzL8sSWZZBKeV8mmbI89zFBeXq2szrjIOZc3j201hDZs0WDodDBEEA3/cRhgGE4AiefJhKzyvs3VlNA68JrJIoihxpWVV4/ZA1LhIImUKVwNbeGe4HDLd9hrXtM6hcu46eCSsiEEKAMTYnIpgahVZ0zkiHwZfNNr797kAQ48flI7S7DFc9joWlY+iiAueM7kp49nVdFIjjmFTSnHSJ1nkXPNU4bIf4/PXCKfy0cYmNX10XL66c4OZRoDOQ+LDUopnWkCQoSZKZQjuLcDwBJ4UTprC+cwV/kuD0JsLqz3un+PvBP+yfjKi9Auu7d+gOBXojgdUfd+Ayc0ux5pXE/udvhOvbDh77I0oq9xIjn6mctivBEu3OOLUkswJSCponjSNRszjJX5ZSVjUG/hQPvT6ewikR5eQjxCJDzFOEk5gKNMYRIwgXB+Opy00JfhBBprOtO8K323z9C7yP9+/9B/a0q1QWwv7WAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"ProcessDiagram3\"\n        title=\"\"\n        src=\"/static/ProcessDiagram3-7471e1e730018c3a11bdaa2a828668eb-103bb.png\"\n        srcset=\"/static/ProcessDiagram3-7471e1e730018c3a11bdaa2a828668eb-f4ee9.png 210w,\n/static/ProcessDiagram3-7471e1e730018c3a11bdaa2a828668eb-813e2.png 420w,\n/static/ProcessDiagram3-7471e1e730018c3a11bdaa2a828668eb-103bb.png 649w\"\n        sizes=\"(max-width: 649px) 100vw, 649px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n        </li>\n<li>结果分析：   </li>\n</ul>\n<p>① 对于原始型、紧凑型、MongoDB 型瓦片，相对于单机上的单进程切图，单机上的多进程切图都可以显著提高切图效率。</p>\n<p>② 每个切图机器最适合的进程数是CPU核数*2，即双核CPU开4个进程，4核开8个以此类推。</p>\n<p>③ MongoDB 瓦片存储方式，提升的效率最高，普通4核PC机平均提升4-5倍，测试中最高可提升到近6倍。MongoDB 型>紧凑型>原始型</p>\n<h3 id=\"多机多任务切图效率\"><a href=\"#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E5%9B%BE%E6%95%88%E7%8E%87\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>多机多任务切图效率</h3>\n<ul>\n<li>MongoDB 型瓦片: 瓦片存储为远程存储；地图本地地图；测试过程：逐步增加主切图节点的进程，从单个进程(single)逐渐增加到8，然后再增加其他机器补充总的进程数。<br>\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ProcessDiagram4-a9490321d1461308d7b8a25b872dc117-b8825.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 575px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 49.39130434782609%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABz0lEQVQoz5VSy27bMBDU/39Cr+21aIugh56KNj00hwKOEcdxbEm2ZEYPUiJFvR/WZEkjidtbKYyWu0uORrvrnE4nvKBtW9R1bdE0DaqqsrbrOhszeYO+723MwOwvORzzellKKcRxDCGEBWMMnHMURWH9PM8tyrKElNLGm6bF5XolHMfRqvifNQ092lpDFwqlVlbtK6FRt9vtiHiyiWEYyA4YyDcf6+myifd9RworRMcAW49hcR/ids1ws3xC12g403QmNL9kCIGZHmCgi+M4oCkV6kqDJwn9pgILDtgdEny99rDcCnz+GeDPA8fVrwNJbt8UCqqV7/vI6dIT1W6x8rDZ7vHj9wbuPsb7qyUe9xzvPt3BPSp8+OYSYYaP333crFJ8uQ5ISwdnHE8omxFBECLlAqkowI4R7j2B7UHgzs1wTCvckpqIV1g8crIlkXGEicbKy+AzhfU+x0hlcaRusXiIsFpvELIYmSyhdA1ZlMhVCa21jZnOGqt1QbkaWS6hisraXGrqvqR609g0TYeMlLl+CBYLJKQw4RJRSiPEC1KszvtUWj9KcjqjcYzoLKfykB9zc4YUUj+oKRPm+TwGM20uh9TgLTb/4/+dN9ZwPQOYMvjvYHP6XQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"ProcessDiagram4\"\n        title=\"\"\n        src=\"/static/ProcessDiagram4-a9490321d1461308d7b8a25b872dc117-b8825.png\"\n        srcset=\"/static/ProcessDiagram4-a9490321d1461308d7b8a25b872dc117-4db2d.png 210w,\n/static/ProcessDiagram4-a9490321d1461308d7b8a25b872dc117-9c54c.png 420w,\n/static/ProcessDiagram4-a9490321d1461308d7b8a25b872dc117-b8825.png 575w\"\n        sizes=\"(max-width: 575px) 100vw, 575px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n        </li>\n<li>原始型瓦片: 瓦片存储为本地存储；地图本地地图；测试过程：逐步增加主切图节点的进程，从单个进程(single)逐渐增加到8，然后再增加其他机器补充总的进程数。<br>\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ProcessDiagram5-00c5f52951fd6cda1b272c09f6841ada-b8825.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 575px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 48%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB2klEQVQoz61SO48TMRC+H0tHT5sK0SAkBA0UIJoUQIFoEI8GkHLHpTjg7hId4cLmkn35vLbX3l3vZjf7MXZyqSgZafR57JlvXj7YbDZw6qSqKkgpIYSAMWZ/dvdaaxRFscc8z2GtRU9xNxxd1+EAO3EXSinEcQzGmCdyZ6eGCJzNs4yUk1++S6pdpI/t+96jJ3RGmqa+kn9J1zbe5/dkipzIpOAwWmEVC5ycBeg2na9uT7herxGGIaqy2j10KKhlwSLI3GA0nqIsDQaPvuJinuLVx1/4cBjgy0mEuy8mPqkrqL1p2dY1FosFmqZBFDGkSYzR9xWevTlDwg1u3fvm+sDth6e4jAo8efsHrz+HOJ4KDJ5vCa+ulmjbdktY1xZBEPh5vKTsn47mODpnuD88hdQN7jw+pi46DJ6OcblSGL6f4d1ogfEkxYPhTzcUT+ZbXnGqLmRYLlfQpkJMFSVZAWUsUp4T1oiZ8naUKkpgqWoNkVdgmfFztPXad+C3PJ3F+HE+w8VsTgECCcsQJhxcaEQxA5clwijBNWEUp0RC9/TOuPQJQ/IpbbtdniO0tNlMKLBr+gZlg0zSMhT9M6o2k5rQEuYehbcrejdQuiStvH9D49gT4j9JvyP8C6U98qDR7Ub+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"ProcessDiagram5\"\n        title=\"\"\n        src=\"/static/ProcessDiagram5-00c5f52951fd6cda1b272c09f6841ada-b8825.png\"\n        srcset=\"/static/ProcessDiagram5-00c5f52951fd6cda1b272c09f6841ada-4db2d.png 210w,\n/static/ProcessDiagram5-00c5f52951fd6cda1b272c09f6841ada-9c54c.png 420w,\n/static/ProcessDiagram5-00c5f52951fd6cda1b272c09f6841ada-b8825.png 575w\"\n        sizes=\"(max-width: 575px) 100vw, 575px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n        </li>\n<li>紧凑型瓦片: 瓦片存储为本地存储；地图本地地图；测试过程：逐步增加主切图节点的进程，从单个进程(single)逐渐增加到8，然后再增加其他机器补充总的进程数。<br>\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ProcessDiagram6-6490ef0d7a2649b7c30ce2fb038d88c4-6ecc0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 596px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.31543624161073%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABoElEQVQoz3WSy2/UMBDG++cjjpwQZyQucOiJA0VVT0tVxFZ9aJtsyaZL3vErifPqxv6wnd1uJcRIo2/Gln+e8fhEaw2llHMb73Y7NE0DKSW6rnuJh2FA23ZuzbqN+76HenXe+skBdDB7OI5jpGkKSimiKEKWZaiqyuQEjDEIzlHXcw49vRTzD9ACrB/seM1sXdebC1sUpcDTNoW3KXD6fYVx6F3FluOA1qZpAiEEQogZZja1moxOc8u9xOVPH2fnS1wsU7z/codfXom3n3xAjaaL/FihNWWAeZ67NyuLErlpMwgTbMI/OFs84uvFA75dJfhw6mNxV+LdZw/3Acebj/cOSCibgVor7CYN2Y34HWzMBsdjWMILMlw/pFiuEtysCX7cZvCeKC5vE6y3DIubGEHEcX4VojcDc0VZoA0S0uJ6FcH310gyAl5J4y0a2UHUEsLkdd04Zbzar1VgQoIyjmGcjkD78PZBC9NiuI0drKQVCipAmFHCXZ4bpbxBXs5aGCWsRlZQjM+vgO7/2AHsJ6mUifV+KE6PsfqPzvvzt/kLGBatUdqiacMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"ProcessDiagram6\"\n        title=\"\"\n        src=\"/static/ProcessDiagram6-6490ef0d7a2649b7c30ce2fb038d88c4-6ecc0.png\"\n        srcset=\"/static/ProcessDiagram6-6490ef0d7a2649b7c30ce2fb038d88c4-0d720.png 210w,\n/static/ProcessDiagram6-6490ef0d7a2649b7c30ce2fb038d88c4-4ced5.png 420w,\n/static/ProcessDiagram6-6490ef0d7a2649b7c30ce2fb038d88c4-6ecc0.png 596w\"\n        sizes=\"(max-width: 596px) 100vw, 596px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n        </li>\n<li>结果分析：   </li>\n</ul>\n<p>① 对于原始型、紧凑型、MongoDB 型瓦片，相对于单机上的单进程切图，单机上的多进程切图都可以显著提高切图效率。</p>\n<p>② 每个切图机器最适合的进程数是CPU核数*2，即双核CPU开4个进程，4核开8个以此类推。</p>\n<p>③ MongoDB 瓦片存储方式，提升的效率最高，普通4核PC机平均提升4-5倍，测试中最高可提升到近6倍。MongoDB 型>紧凑型>原始型  </p>\n<h3 id=\"本地和远程路径切图效率\"><a href=\"#%E6%9C%AC%E5%9C%B0%E5%92%8C%E8%BF%9C%E7%A8%8B%E8%B7%AF%E5%BE%84%E5%88%87%E5%9B%BE%E6%95%88%E7%8E%87\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>本地和远程路径切图效率</h3>\n<p> 切图地图和瓦片存储位置来自本地目录还是共享目录，形成了4种切图场景。  </p>\n<ul>\n<li>本地地图-本地瓦片：即切图数据放在本地，切好的瓦片也存储在本地。 </li>\n<li>本地地图-远程瓦片：即切图数据放在本地，切好的瓦片也存储在远程机器中。 </li>\n<li>远程地图-本地瓦片：即切图数据放在远程，切好的瓦片也存储在本地。 </li>\n<li>远程地图-远程瓦片：即切图数据放在远程，切好的瓦片也存储在远程。   </li>\n</ul>\n<p>每台机器开启四个切图子任务,得到如下效率对比图：<br>\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ProcessDiagram7-177a64c02eace1ac4d232ed234d981d4-6d201.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 576px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 57.638888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABv0lEQVQoz5VTa5OCMAzk//9C5xRBBeQlbaHQJ+6l5XRwxi/nsBPWJNtsgGRdVwQ8n0+87l/QWkMp9RG/1e2RhIIA7/1b+NX0eDxQFAXquo6xbdstv6vbI2gk+PsJIWCtjUJ+pYLw55cmSmGl1DaR/5guCoabYKfv+80SFc+sx8QH+E2VLv8W82qCkyweGjmJvNy9BaWU4JzDGENFVKhnzHUOVl3AhASTHvMkYYYKltVYxw5uKKN4FN1PGGyGXb0Ew0ST8miYQVM1aPMj6kuG8nzCOSvRMYmWzeCMg1c5uuJKfXa/w2fcBWMsWg4HLGqLwbK3Bn4R0WKA1gajVFDaQluHRY4wWsG5zXqiHTBwieMpRVF1OGU3pNkV+fWOsh5wOl9xOObIiN8of/g5I7sUlOuR32rKZTimF5T3HoYOSKqiwc/hRA0l6k5ALoaEG5pCg00aYlpQtz0EcSENGJ+ID1RnwUaNfuAEgYm4oukTxgTSNEP3EOCTIQGFe9PHOAgFPs4kQDsm8YDwkJqOYZoNhlFRH48YiUdB49a4D2Mc7cTD0i6s3WD+eLBiPvgu2i0fuHNu+1LCg/n25v8X4dX5BQc+oktkFf8IAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"ProcessDiagram7\"\n        title=\"\"\n        src=\"/static/ProcessDiagram7-177a64c02eace1ac4d232ed234d981d4-6d201.png\"\n        srcset=\"/static/ProcessDiagram7-177a64c02eace1ac4d232ed234d981d4-5e329.png 210w,\n/static/ProcessDiagram7-177a64c02eace1ac4d232ed234d981d4-7b3e6.png 420w,\n/static/ProcessDiagram7-177a64c02eace1ac4d232ed234d981d4-6d201.png 576w\"\n        sizes=\"(max-width: 576px) 100vw, 576px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>结果分析：   </li>\n</ul>\n<p>① 原始型瓦片，地图来自本地并且本地存储瓦片的时候，效率最高。大规模切图应用推荐此场景。</p>\n<p>② 紧凑型瓦片，数据来自共享目录时效率略低，不过也跟MongoDB效率相当。</p>\n<p>③ MongoDB 瓦片，受数据来源和存储位置影响不大。</p>\n<h3 id=\"矢量栅格地图切图效率\"><a href=\"#%E7%9F%A2%E9%87%8F%E6%A0%85%E6%A0%BC%E5%9C%B0%E5%9B%BE%E5%88%87%E5%9B%BE%E6%95%88%E7%8E%87\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>矢量/栅格地图切图效率</h3>\n<p>矢量和栅格地图均来自本地，其中栅格地图为镶嵌数据集，含822张分辨率为90米的 img 影像，单张影像行列数为6000*6000；文件大小：44.7G；切图得到的瓦片数与矢量地图切得的瓦片数相同，总计产生1638400张瓦片；且切图比例尺相同。  </p>\n<p>分三种场景：本地 MongDB，远程 MongDB 和本地紧凑。使用一个切图节点，每个节点开启4个切图进程。 得到如下效率比对图：</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ProcessDiagram8-db679d07bc1439c0ecf5ac57b4769a15-99b6f.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 572px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 45.629370629370634%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABdUlEQVQoz4VSi26cMBDk/z8wjaI2udxxwNkBA37hB0zHTi9Koki1NF6x7I5n1m72fcdnHMdRo7UW67pCa11hjPmA9x7f++5oyvZ5FcICIQTatkXXdbherxiGoaLveyilas339YWwxBgjpJTIOeN/K+8HXMiYdMQWEvvzV8JCVqzdCVNMbKKNMoJjR8o7jE9YXYIcNdWOdKEwS4EUNvbslfSD8D6zaZr+KTywzBq32wTRDRCXC2R7wXB6gR1viIvEoSXgFxw/zdA5V0kLYkrVhh4ljOzg9FovIjiLHDzdJCS2RcJtkf82pJSrkCZxU4ZWjIexHvNqoVaPbpB4fu3QS4XFcLbK4M+pxcu5hxgXvCkLbTb8fj7jdO6gbWD/hsb6wFsUePj1hIfHJ5zbnqSOKjPeRlWVGsdiF2HdhkktCDFj1lRKmfOiq5CNuVLXhMDC6cbn0VOV4MCpiMWOB82LqVHz5IJ3ByUX32tod6Gj1XBczHl+/wXihrjhTOJGnwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"ProcessDiagram8\"\n        title=\"\"\n        src=\"/static/ProcessDiagram8-db679d07bc1439c0ecf5ac57b4769a15-99b6f.png\"\n        srcset=\"/static/ProcessDiagram8-db679d07bc1439c0ecf5ac57b4769a15-87027.png 210w,\n/static/ProcessDiagram8-db679d07bc1439c0ecf5ac57b4769a15-b6e41.png 420w,\n/static/ProcessDiagram8-db679d07bc1439c0ecf5ac57b4769a15-99b6f.png 572w\"\n        sizes=\"(max-width: 572px) 100vw, 572px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>结果分析： 栅格地图的切图时间，明显比矢量地图长。 </li>\n</ul>\n<h3 id=\"结论\"><a href=\"#%E7%BB%93%E8%AE%BA\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>结论</h3>\n<p>通过上述四个场景的可总结得到如下结论： </p>\n<ul>\n<li>结论1：单机多进程能有效提升切图速度，效率提升为本机CPU核数的倍数。例如4核CPU的机器可提升到4倍左右，16核CPU的机器可提升到16倍左右。 </li>\n<li>结论2：每个切图节点，建议开启CPU*2个切图任务。 </li>\n<li>结论3：切MongoDB类型的瓦片，可以支撑更多的切图节点并行工作。更大规模的切图任务，建议部署为多机分布式切MongoDB类型的瓦片。物理资源不受限的情况下，最高可以达到每秒生产并写入5000张瓦片的性能。 </li>\n<li>结论4：紧凑瓦片，建议地图数据部署在本机，瓦片也保存在本机效率最高。原始类型的瓦片不适合数据迁移，这里不做结论。 </li>\n<li>结论5：相同进程数的切图任务，紧凑型瓦片效率最高，在瓦片任务量不是特别大的情况下，推荐部署方案为使用一台较高性能的物理机采用单机多进程切图。 </li>\n<li>结论6：紧凑和原始类型的瓦片，推荐使用单机多进程。多机分布式效率提升不明显。 </li>\n<li>结论7：MongoDB 型的瓦片，建议 MongoDB 服务部署在非切图节点的机器上。MongoDB 比较吃内存，部署在切图节点上，会影响切图速度。 </li>\n</ul>\n<p>通过上述结论，用户可根据自身切图数据情况，瓦片类型，以及计算机性能合理选择切图方式。切图过程中，根据机器资源，增加/减少进程数，做到合理有效地利用计算机资源，最大限度的提升切图效率。</p>","frontmatter":{"title":"","next":null,"prev":null},"fields":{"path":"content\\Java\\docs\\Cache\\MultiTaskSuggest.md","slug":"/Java/docs/Cache/MultiTaskSuggest.html"}}},"pageContext":{"slug":"/Java/docs/Cache/MultiTaskSuggest.html"}}